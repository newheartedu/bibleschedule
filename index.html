<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PJBC 讀經進度</title>
    <meta name="description" content="PJBC 平鎮浸信會 每日讀經進度查詢">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    screens: {
                        'print': {'raw': 'print'},
                    }
                }
            }
        }
    </script>
    
    <!-- 引入 html2pdf.js 與 html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- 引入 JSZip 用於多圖打包下載 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.294.0"
      }
    }
    </script>
    
    <!-- 引入 Google Fonts: Noto Serif TC (列印用) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700;900&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* --- 網站預設字體 (不改變) --- */
        body {
            background-color: #F9F9F7;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans TC", sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }

        /* --- 列印與預覽專用樣式 (Print Styles) --- */
        
        /* A4 設定：精確控制 */
        @page {
            size: A4 portrait;
            margin: 0; /* 清除瀏覽器預設邊距，由 CSS 控制內容邊距 */
        }

        /* 列印容器：單頁強制設定 */
        .print-page-container {
            width: 210mm;
            height: 296mm; /* A4 高度 */
            padding: 12mm 15mm; /* 舒適的邊距 */
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin: 0 auto 20px auto;
            box-sizing: border-box;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* 防止溢出 */
            page-break-after: always; /* 預覽時每頁後換頁 */
        }

        /* 最後一頁取消強制換頁，避免多出空白頁 */
        .print-page-container:last-child {
            page-break-after: auto;
            margin-bottom: 0;
        }

        /* --- 列印專用字體設定 (只影響預覽區塊) --- */
        .print-page-container {
            font-family: 'Noto Serif TC', serif; /* 統一使用襯線體增加書卷氣與專業感 */
            color: #000;
        }

        /* 設計感標題區 */
        .print-header {
            border-bottom: 3px double #000;
            padding-bottom: 10px;
            margin-bottom: 12px;
            text-align: center;
        }

        .print-title {
            font-size: 36px; /* 加大標題 */
            font-weight: 900; /* 最粗體 */
            color: #000; /* 全黑 */
            letter-spacing: 2px;
            line-height: 1.1;
            margin-bottom: 4px;
            /* 模擬更粗的字重，以防字體不支援 */
            text-shadow: 0.5px 0 0 currentColor; 
        }

        .print-subtitle {
            font-size: 20px; /* 副標題放大 */
            font-weight: 700;
            letter-spacing: 4px;
            color: #222;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }

        .print-subtitle::before,
        .print-subtitle::after {
            content: "";
            display: block;
            width: 30px;
            height: 1px;
            background: #444;
        }

        .print-meta {
            position: absolute;
            /* top 由 React 動態控制 */
            right: 15mm;
            text-align: right;
            font-family: 'Noto Sans TC', sans-serif;
            color: #000;
        }
        
        .print-meta-year {
            font-size: 14px;
            font-weight: bold;
        }

        .print-meta-month {
            font-size: 36px;
            font-weight: 900;
            line-height: 0.9;
        }

        /* 表格容器：Flex 1 自動填滿剩餘高度 */
        .table-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            width: 100%;
            overflow: hidden;
        }

        /* 表格樣式 */
        .design-table {
            width: 100%;
            height: 100%; /* 強制撐滿容器高度 */
            border-collapse: collapse;
            table-layout: fixed; /* 固定佈局 */
        }
        
        .design-table th {
            background-color: #f0f0f0;
            border-top: 2px solid #000;
            border-bottom: 2px solid #000;
            border-left: 1px solid #ccc;
            border-right: 1px solid #ccc;
            padding: 4px;
            font-weight: 800;
            text-align: center;
            font-size: 16px;
            font-family: 'Noto Sans TC', sans-serif; /* 標題用黑體較清晰 */
            height: 36px; /* 固定標題高度 */
            color: #000;
        }

        .design-table th:first-child { border-left: none; }
        .design-table th:last-child { border-right: none; }

        .design-table td {
            border-bottom: 1px solid #ddd;
            border-left: 1px solid #eee;
            border-right: 1px solid #eee;
            vertical-align: middle;
            padding: 0 6px;
            /* height 不設定，由瀏覽器自動均分 tbody 的高度 */
        }

        .design-table tr:last-child td {
            border-bottom: 2px solid #000; /* 表格底部粗線 */
        }

        .design-table tr:nth-child(even) {
            background-color: #fafafa; /* 隔行底色，增加閱讀性 */
        }

        /* 單元格內容優化 */
        .cell-date {
            text-align: center;
            font-family: 'Noto Sans TC', sans-serif;
            font-weight: 700;
            font-size: 16px;
            color: #000;
        }
        
        .cell-weekday {
            font-size: 12px;
            font-weight: normal;
            color: #444;
            margin-left: 4px;
        }

        .cell-scripture {
            font-size: 13px; /* 稍微縮小以容納長英文單字 */
            font-weight: 600;
            white-space: nowrap; /* 保持單行，若太長可能會截斷，但保持整潔 */
            overflow: hidden;
            text-overflow: clip; 
            letter-spacing: 0.5px;
            color: #000;
        }

        .cell-check {
            text-align: center;
            padding: 0;
        }

        .design-checkbox {
            width: 16px;
            height: 16px;
            border: 1.5px solid #333;
            border-radius: 3px;
            margin: 0 auto;
        }

        /* 頁尾 */
        .print-footer {
            margin-top: 8px;
            font-size: 10px;
            color: #666;
            text-align: center;
            font-family: 'Noto Sans TC', sans-serif;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 12px;
        }

        /* 列印時隱藏非預覽元素 */
        @media print {
            body { background: white; margin: 0; padding: 0; }
            body > *:not(#print-preview-root) { display: none !important; }
            
            /* 修正列印時的容器行為 */
            #print-preview-root {
                display: block !important;
                position: static !important; /* 關鍵：改為 static 以支援自然換頁 */
                width: 100%;
                height: auto;
                overflow: visible !important;
                background: white;
            }

            .no-print-in-preview { display: none !important; }
            
            .print-page-container {
                box-shadow: none; 
                margin: 0; 
                width: 210mm;
                height: 296mm; /* 維持固定高度 */
                page-break-after: always;
                break-after: page; /* 現代瀏覽器支援 */
                overflow: hidden;
            }

            .print-page-container:last-child {
                page-break-after: auto; /* 避免最後一頁後空白 */
                break-after: auto;
                height: auto; /* 最後一頁允許自動高度，減少空白頁風險 */
                min-height: 296mm;
            }
            
            /* 強制列印背景色 (為了隔行底色) */
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <div id="print-preview-root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
          Calendar as CalendarIcon, List, Home, Settings, ChevronLeft, ChevronRight, CheckCircle, Circle, 
          Star, BookOpen, Edit3, X, Search, Download, RefreshCw, Sparkles, Bookmark, Book, ArrowRight, 
          TrendingUp, LayoutGrid, Sun, Globe, Printer, Eye, FileDown, Image as ImageIcon, FileText, Fish
        } from 'lucide-react';

        // --- 全域資料設定 (移至最上方以確保讀取) ---
        const TRANSLATIONS = {
            zh: {
                title: "PJBC 平鎮浸信會",
                subtitle: "讀經進度", // 網站用
                print_subtitle: "讀經進度表", // 列印用
                greeting: "平安！願神的話語成為你腳前的燈",
                today_btn: "今日進度",
                days_read: "已讀天數",
                days_unit: "天",
                full_schedule: "完整進度表",
                view_list: "查看列表",
                daily_one: "每日一章", 
                daily_ten: "每日十章", 
                mark_read: "標記已讀",
                marked: "已讀完",
                note_title: "靈修筆記", 
                note_placeholder: "記錄神今天對你說的話...",
                source: "來源: Bolls.life API",
                version: "和合本 (CUV)",
                loading: "載入中...",
                no_data: "無資料",
                print_btn: "下載/列印",
                print_modal_title: "列印與下載設定",
                print_desc: "請選擇年份與月份 (可多選)，系統將生成專用的 A4 進度表。",
                print_preview_btn: "預覽文件",
                print_now: "立即列印",
                download_png: "下載所有圖片 (PNG)",
                download_pdf: "下載 PDF",
                close_preview: "關閉",
                cancel: "取消",
                year: "年",
                month: "月",
                check_col: "完成",
                date_col: "日期",
                select_all: "全選",
                deselect_all: "取消全選",
                nav: { home: "首頁", calendar: "月曆", table: "列表", admin: "管理" }
            },
            en: {
                title: "PJBC", 
                subtitle: "Bible Schedule",
                print_subtitle: "Bible Reading Schedule",
                greeting: "Peace! Your word is a lamp for my feet",
                today_btn: "Today's Plan",
                days_read: "Days Read",
                days_unit: "days",
                full_schedule: "Full Schedule",
                view_list: "View List",
                daily_one: "Daily One",
                daily_ten: "Daily Ten",
                mark_read: "Mark Read",
                marked: "Finished",
                note_title: "Devotional Notes",
                note_placeholder: "What is God saying to you today?",
                source: "Source: Bolls.life API",
                version: "English (WEB)",
                loading: "Loading...",
                no_data: "No Data",
                print_btn: "Download/Print",
                print_modal_title: "Print & Download Settings",
                print_desc: "Select year and month(s) to generate printable A4 schedules.",
                print_preview_btn: "Preview Document",
                print_now: "Print Now",
                download_png: "Download Image",
                download_pdf: "Download PDF",
                close_preview: "Close",
                cancel: "Cancel",
                year: "",
                month: "",
                check_col: "✓", // 修改：Checkmark symbol
                date_col: "Date",
                select_all: "Select All",
                deselect_all: "Clear",
                nav: { home: "Home", calendar: "Calendar", table: "List", admin: "Admin" }
            }
        };

        // 星期對照表
        const WEEKDAY_MAP = { "日": "Sun", "一": "Mon", "二": "Tue", "三": "Wed", "四": "Thu", "五": "Fri", "六": "Sat" };

        const ABBREV_TO_FULL_ZH = {
            "創": "創世記", "出": "出埃及記", "利": "利未記", "民": "民數記", "申": "申命記",
            "書": "約書亞記", "士": "士師記", "得": "路得記", "撒上": "撒母耳記上", "撒下": "撒母耳記下",
            "王上": "列王紀上", "王下": "列王紀下", "代上": "歷代志上", "代下": "歷代志下",
            "拉": "以斯拉記", "尼": "尼希米記", "斯": "以斯帖記", "伯": "約伯記",
            "詩": "詩篇", "箴": "箴言", "傳": "傳道書", "歌": "雅歌",
            "賽": "以賽亞書", "耶": "耶利米書", "哀": "耶利米哀歌", "結": "以西結書", "但": "但以理書",
            "何": "何西阿書", "珥": "約珥書", "摩": "阿摩司書", "俄": "俄巴底亞書", "拿": "約拿書", "彌": "彌迦書",
            "鴻": "那鴻書", "哈": "哈巴谷書", "番": "西番雅書", "該": "哈該書", "亞": "撒迦利亞書", "瑪": "瑪拉基書",
            "太": "馬太福音", "可": "馬可福音", "路": "路加福音", "約": "約翰福音", "徒": "使徒行傳",
            "羅": "羅馬書", "林前": "哥林多前書", "林後": "哥林多後書", "加": "加拉太書", "弗": "以弗所書",
            "腓": "腓立比書", "西": "歌羅西書", "帖前": "帖撒羅尼迦前書", "帖後": "帖撒羅尼迦後書",
            "提前": "提摩太前書", "提後": "提摩太後書", "多": "提多書", "門": "腓利門書", "來": "希伯來書", 
            "雅": "雅各書", "彼前": "彼得前書", "彼後": "彼得後書", "約一": "約翰一書", "約二": "約翰二書", "約三": "約翰三書",
            "猶": "猶大書", "啟": "啟示錄"
        };
        const FULL_TO_ABBREV_ZH = Object.fromEntries(Object.entries(ABBREV_TO_FULL_ZH).map(([k, v]) => [v, k]));

        // 中文(全名或縮寫) 轉 英文縮寫對照表 (Calendar用)
        const ZH_TO_EN_ABBREV = {
            "創世記": "Gen", "創": "Gen", "出埃及記": "Exod", "出": "Exod", "利未記": "Lev", "利": "Lev", "民數記": "Num", "民": "Num", "申命記": "Deut", "申": "Deut",
            "約書亞記": "Josh", "書": "Josh", "士師記": "Judg", "士": "Judg", "路得記": "Ruth", "得": "Ruth",
            "撒母耳記上": "1 Sam", "撒上": "1 Sam", "撒母耳記下": "2 Sam", "撒下": "2 Sam",
            "列王紀上": "1 Kgs", "王上": "1 Kgs", "列王紀下": "2 Kgs", "王下": "2 Kgs",
            "歷代志上": "1 Chr", "代上": "1 Chr", "歷代志下": "2 Chr", "代下": "2 Chr",
            "以斯拉記": "Ezra", "拉": "Ezra", "尼希米記": "Neh", "尼": "Neh", "以斯帖記": "Esth", "斯": "Esth",
            "約伯記": "Job", "伯": "Job", "詩篇": "Ps", "詩": "Ps", "箴言": "Prov", "箴": "Prov", "傳道書": "Eccl", "傳": "Eccl", "雅歌": "Song", "歌": "Song",
            "以賽亞書": "Isa", "賽": "Isa", "耶利米書": "Jer", "耶": "Jer", "耶利米哀歌": "Lam", "哀": "Lam", "以西結書": "Ezek", "結": "Ezek", "但以理書": "Dan", "但": "Dan",
            "何西阿書": "Hos", "何": "Hos", "約珥書": "Joel", "珥": "Joel", "阿摩司書": "Amos", "摩": "Amos", "俄巴底亞書": "Obad", "俄": "Obad", "約拿書": "Jonah", "拿": "Jonah", "彌迦書": "Mic", "彌": "Mic",
            "那鴻書": "Nah", "鴻": "Nah", "哈巴谷書": "Hab", "哈": "Hab", "西番雅書": "Zeph", "番": "Zeph", "哈該書": "Hag", "該": "Hag", "撒迦利亞書": "Zech", "亞": "Zech", "瑪拉基書": "Mal", "瑪": "Mal",
            "馬太福音": "Matt", "太": "Matt", "馬可福音": "Mark", "可": "Mark", "路加福音": "Luke", "路": "Luke", "約翰福音": "John", "約": "John", "使徒行傳": "Acts", "徒": "Acts",
            "羅馬書": "Rom", "羅": "Rom", "哥林多前書": "1 Cor", "林前": "1 Cor", "哥林多後書": "2 Cor", "林後": "2 Cor", "加拉太書": "Gal", "加": "Gal",
            "以弗所書": "Eph", "弗": "Eph", "腓立比書": "Phil", "腓": "Phil", "歌羅西書": "Col", "西": "Col",
            "帖撒羅尼迦前書": "1 Thess", "帖前": "1 Thess", "帖撒羅尼迦後書": "2 Thess", "帖後": "2 Thess",
            "提摩太前書": "1 Tim", "提前": "1 Tim", "提摩太後書": "2 Tim", "提後": "2 Tim", "提多書": "Titus", "多": "Titus", "腓利門書": "Phlm", "門": "Phlm",
            "希伯來書": "Heb", "來": "Heb", 
            "雅各書": "Jas", "雅": "Jas", "彼得前書": "1 Pet", "彼前": "1 Pet", "彼得後書": "2 Pet", "彼後": "2 Pet",
            "約翰一書": "1 John", "約一": "1 John", "約翰二書": "2 John", "約二": "2 John", "約翰三書": "3 John", "約三": "3 John", "猶大書": "Jude", "猶": "Jude", "啟示錄": "Rev", "啟": "Rev"
        };

        const BIBLE_BOOKS_ID = {
          "創世記": 1, "創": 1, "出埃及記": 2, "出": 2, "利未記": 3, "利": 3, "民數記": 4, "民": 4, "申命記": 5, "申": 5,
          "約書亞記": 6, "書": 6, "士師記": 7, "士": 7, "路得記": 8, "得": 8, "撒母耳記上": 9, "撒上": 9, "撒母耳記下": 10, "撒下": 10,
          "列王紀上": 11, "王上": 11, "列王紀下": 12, "王下": 12, "歷代志上": 13, "代上": 13, "歷代志下": 14, "代下": 14,
          "以斯拉記": 15, "拉": 15, "尼希米記": 16, "尼": 16, "以斯帖記": 17, "斯": 17, "約伯記": 18, "伯": 18,
          "詩篇": 19, "詩": 19, "箴言": 20, "箴": 20, "傳道書": 21, "傳": 21, "雅歌": 22, "歌": 22,
          "以賽亞書": 23, "賽": 23, "耶利米書": 24, "耶": 24, "耶利米哀歌": 25, "哀": 25, "以西結書": 26, "結": 26,
          "但以理書": 27, "但": 27, "何西阿書": 28, "何": 28, "約珥書": 29, "珥": 29, "阿摩司書": 30, "摩": 30,
          "俄巴底亞書": 31, "俄": 31, "約拿書": 32, "拿": 32, "彌迦書": 33, "彌": 33, "那鴻書": 34, "鴻": 34,
          "哈巴谷書": 35, "哈": 35, "西番雅書": 36, "番": 36, "哈該書": 37, "該": 37, "撒迦利亞書": 38, "亞": 38, "瑪拉基書": 39, "瑪": 39,
          "馬太福音": 40, "太": 40, "馬可福音": 41, "可": 41, "路加福音": 42, "路": 42, "約翰福音": 43, "約": 43, "使徒行傳": 44, "徒": 44,
          "羅馬書": 45, "羅": 45, "哥林多前書": 46, "林前": 46, "哥林多後書": 47, "林後": 47, "加拉太書": 48, "加": 48,
          "以弗所書": 49, "弗": 49, "腓立比書": 50, "腓": 50, "歌羅西書": 51, "西": 51, "帖撒羅尼迦前書": 52, "帖前": 52, "帖撒羅尼迦後書": 53, "帖後": 53,
          "提摩太前書": 54, "提前": 54, "提摩太後書": 55, "提後": 55, "提多書": 56, "多": 56, "腓利門書": 57, "門": 57,
          "希伯來書": 58, "來": 58, 
          "雅各書": 59, "雅": 59, "彼得前書": 60, "彼前": 60, "彼得後書": 61, "彼後": 61,
          "約翰一書": 62, "約一": 62, "約翰二書": 63, "約二": 63, "約翰三書": 64, "約三": 64, "猶大書": 65, "猶": 65, "啟示錄": 66, "啟": 66
        };

        // 詳細英文書名對照表 (用於 formatScriptureDisplay 與 BibleReader)
        const ZH_TO_EN_BOOKS = {
             "創世記": "Genesis", "創": "Genesis", "出埃及記": "Exodus", "出": "Exodus", "利未記": "Leviticus", "利": "Leviticus", "民數記": "Numbers", "民": "Numbers", "申命記": "Deuteronomy", "申": "Deuteronomy",
            "約書亞記": "Joshua", "書": "Joshua", "士師記": "Judges", "士": "Judges", "路得記": "Ruth", "得": "Ruth", "撒母耳記上": "1 Samuel", "撒上": "1 Samuel", "撒母耳記下": "2 Samuel", "撒下": "2 Samuel",
            "列王紀上": "1 Kings", "王上": "1 Kings", "列王紀下": "2 Kings", "王下": "2 Kings", "歷代志上": "1 Chronicles", "代上": "1 Chronicles", "歷代志下": "2 Chronicles", "代下": "2 Chronicles",
            "以斯拉記": "Ezra", "拉": "Ezra", "尼希米記": "Nehemiah", "尼": "Nehemiah", "以斯帖記": "Esther", "斯": "Esther", "約伯記": "Job", "伯": "Job",
            "詩篇": "Psalms", "詩": "Psalms", "箴言": "Proverbs", "箴": "Proverbs", "傳道書": "Ecclesiastes", "傳": "Ecclesiastes", "雅歌": "Song of Songs", "歌": "Song of Songs",
            "以賽亞書": "Isaiah", "賽": "Isaiah", "耶利米書": "Jeremiah", "耶": "Jeremiah", "耶利米哀歌": "Lamentations", "哀": "Lamentations", "以西結書": "Ezekiel", "結": "Ezekiel", "但以理書": "Daniel", "但": "Daniel",
            "何西阿書": "Hosea", "何": "Hosea", "約珥書": "Joel", "珥": "Joel", "阿摩司書": "Amos", "摩": "Amos", "俄巴底亞書": "Obadiah", "俄": "Obadiah", "約拿書": "Jonah", "拿": "Jonah", "彌迦書": "Micah", "彌": "Micah",
            "那鴻書": "Nahum", "鴻": "Nahum", "哈巴谷書": "Habakkuk", "哈": "Habakkuk", "西番雅書": "Zephaniah", "番": "Zephaniah", "哈該書": "Haggai", "該": "Haggai", "撒迦利亞書": "Zechariah", "亞": "Zechariah", "瑪拉基書": "Malachi", "瑪": "Malachi",
            "馬太福音": "Matthew", "太": "Matthew", "馬可福音": "Mark", "可": "Mark", "路加福音": "Luke", "路": "Luke", "約翰福音": "John", "約": "John", "使徒行傳": "Acts", "徒": "Acts",
            "羅馬書": "Romans", "羅": "Romans", "哥林多前書": "1 Corinthians", "林前": "1 Corinthians", "哥林多後書": "2 Corinthians", "林後": "2 Corinthians", "加拉太書": "Galatians", "加": "Galatians", "以弗所書": "Ephesians", "弗": "Ephesians",
            "腓立比書": "Philippians", "腓": "Philippians", "歌羅西書": "Colossians", "西": "Colossians", "帖撒羅尼迦前書": "1 Thessalonians", "帖前": "1 Thessalonians", "帖撒羅尼迦後書": "2 Thessalonians", "帖後": "2 Thessalonians",
            "提摩太前書": "1 Timothy", "提前": "1 Timothy", "提摩太後書": "2 Timothy", "提後": "2 Timothy", "提多書": "Titus", "多": "Titus", "腓利門書": "Philemon", "門": "Philemon", "希伯來書": "Hebrews", "來": "Hebrews", 
            "雅各書": "James", "雅": "James", "彼得前書": "1 Peter", "彼前": "1 Peter", "彼得後書": "2 Peter", "彼後": "2 Peter", "約翰一書": "1 John", "約一": "1 John", "約翰二書": "2 John", "約二": "2 John", "約翰三書": "3 John", "約三": "3 John",
            "猶大書": "Jude", "猶": "Jude", "啟示錄": "Revelation", "啟": "Revelation"
        };

        const parseScriptureString = (text) => {
            if (!text) return [];
            const segments = text.split(/[;；]/).map(s => s.trim()).filter(s => s);
            const results = [];
            segments.forEach(seg => {
                let cleanSeg = seg.replace(/\(.*?\)/g, '').replace(/（.*?）/g, '').replace(/章/g, '').replace(/第/g, '').trim();
                const sortedKeys = Object.keys(BIBLE_BOOKS_ID).sort((a, b) => b.length - a.length);
                let matchedBook = "";
                let bookId = 0;
                let rangesStr = "";

                for (const key of sortedKeys) {
                    if (cleanSeg.startsWith(key)) {
                        matchedBook = key;
                        bookId = BIBLE_BOOKS_ID[key];
                        rangesStr = cleanSeg.substring(key.length).trim();
                        break;
                    }
                }
                if (bookId) {
                    if (rangesStr) {
                        const parts = rangesStr.split(/[,，]/);
                        parts.forEach(part => {
                            if (part.includes('-')) {
                                const [start, end] = part.split('-').map(n => parseInt(n));
                                if (!isNaN(start) && !isNaN(end)) {
                                    for (let i = start; i <= end; i++) results.push({ zhBook: matchedBook, bookId, chapter: i });
                                }
                            } else {
                                const num = parseInt(part);
                                if (!isNaN(num)) results.push({ zhBook: matchedBook, bookId, chapter: num });
                            }
                        });
                    } else if (["俄巴底亞書","俄","腓利門書","門","約翰二書","約二","約翰三書","約三","猶大書","猶"].includes(matchedBook)) {
                        results.push({ zhBook: matchedBook, bookId, chapter: 1 });
                    }
                }
            });
            return results;
        };

        const formatScriptureDisplay = (text, lang) => {
            if (!text) return "";
            // 加強版：移除所有與書卷結束相關的標記，包含括號（全形/半形）
            let display = text.replace(/\s*[（(]新循環[)）]/g, '')
                              .replace(/新循環/g, '')
                              .replace(/\s*[（(]第一遍讀完[)）]/g, '')
                              .replace(/\s*[（(]舊約一遍終[)）]/g, '')
                              .replace(/\s*[（(]第三遍讀完[)）]/g, '')
                              .replace(/\s*[（(]第二遍讀完[)）]/g, '')
                              .replace(/\s*[（(]卷終[)）]/g, '')
                              .replace(/卷終/g, '');

            if (lang === 'zh') {
                const sortedAbbrevs = Object.keys(ABBREV_TO_FULL_ZH).sort((a, b) => b.length - a.length);
                sortedAbbrevs.forEach(abbrev => {
                    const full = ABBREV_TO_FULL_ZH[abbrev];
                    const regex = new RegExp(`(^|[^\\u4e00-\\u9fa5])${abbrev}(?![\\u4e00-\\u9fa5])`, 'g');
                    if (abbrev === '傳') {
                        display = display.replace(/(^|[^行\u4e00-\u9fa5])傳(?![^\d\s\uff0c\u3001;])/g, `$1${full}`);
                    } else {
                        display = display.replace(regex, `$1${full}`);
                    }
                });
                display = display.replace(/([\u4e00-\u9fa5])\s+(\d)/g, '$1$2');
                display = display.replace(/([\u4e00-\u9fa5]+)(第?)(\d+[-0-9,，]*)(章?)/g, (match, book, prefix, num, suffix) => {
                    return `${book} ${num}`; 
                });
                display = display.replace(/;/g, '；');
            } else {
                const sortedKeys = Object.keys(ZH_TO_EN_BOOKS).sort((a,b) => b.length - a.length);
                sortedKeys.forEach(zh => {
                    if (display.includes(zh)) {
                        display = display.split(zh).join(ZH_TO_EN_BOOKS[zh] + " ");
                    }
                });
                display = display.replace(/第/g, "").replace(/章/g, "").replace(/；/g, "; ");
                display = display.replace(/\s+/g, ' ').trim();
            }
            return display.trim();
        };
        
        const formatCalendarDisplay = (text, lang) => {
            if (!text) return "";
            let simplified = text.replace(/\(.*?\)|\（.*?\）|新循環|卷終/g, '');

            if (lang === 'en') {
                // 英文縮寫處理邏輯
                const sortedKeys = Object.keys(ZH_TO_EN_ABBREV).sort((a,b) => b.length - a.length);
                sortedKeys.forEach(zh => {
                    const regex = new RegExp(zh, 'g');
                    // 取代時，加上空格以便區隔
                    simplified = simplified.replace(regex, ZH_TO_EN_ABBREV[zh] + " ");
                });
                // 清理多餘中文字與符號
                simplified = simplified.replace(/第/g, "").replace(/章/g, "").replace(/；/g, "; ");
                // 移除重複空格
                simplified = simplified.replace(/\s+/g, ' ').trim();
                // 移除逗號前後的空格 (例如 "Matt 1 , 2" -> "Matt 1, 2")
                simplified = simplified.replace(/\s*,\s*/g, ', ');
                return simplified;
            }

            // 中文縮寫處理邏輯
            const sortedFullNames = Object.keys(FULL_TO_ABBREV_ZH).sort((a, b) => b.length - a.length);
            sortedFullNames.forEach(fullName => {
                if (simplified.includes(fullName)) {
                    simplified = simplified.replace(new RegExp(fullName, 'g'), FULL_TO_ABBREV_ZH[fullName]);
                }
            });
            simplified = simplified.replace(/\s+/g, '').replace(/第/g, '').replace(/章/g, '').replace(/；/g, ' ').replace(/，/g, ',');
            return simplified;
        };

        const getButtonLabel = (item, lang) => {
            if (lang === 'zh') {
                const fullName = ABBREV_TO_FULL_ZH[item.zhBook] || item.zhBook;
                return `${fullName} ${item.chapter}`;
            } else {
                let enBook = ZH_TO_EN_BOOKS[item.zhBook] || "Book";
                return `${enBook} ${item.chapter}`;
            }
        };

        const generateInitialData = () => {
             const plans = [];
            const addDay = (date, wd, one, ten) => plans.push({ date, weekday: wd, dailyOne: one, dailyTen: ten });
            
            // 2025-12
            const year2025_Dec = [
                ["2025-12-01", "一", "使徒行傳 1", "約 18-21；徒 1-6"],
                ["2025-12-02", "二", "以西結書 29", "徒 7-16"],
                ["2025-12-03", "三", "以西結書 30", "徒 17-26"],
                ["2025-12-04", "四", "以西結書 31", "徒 27-28；羅 1-8"],
                ["2025-12-05", "五", "以西結書 32", "羅 9-16；林前 1-2"],
                ["2025-12-06", "六", "使徒行傳 2", "林前 3-12"],
                ["2025-12-07", "日", "使徒行傳 3", "林前 13-16；林後 1-6"],
                ["2025-12-08", "一", "使徒行傳 4", "林後 7-13；加 1-3"],
                ["2025-12-09", "二", "以西結書 33", "加 4-6；弗 1-6；腓 1"],
                ["2025-12-10", "三", "以西結書 34", "腓 2-4；歌 1-4；帖前 1-3"],
                ["2025-12-11", "四", "以西結書 35", "帖前 4-5；帖後 1-3；提前 1-5"],
                ["2025-12-12", "五", "以西結書 36", "提前 6；提後 1-4；多 1-3；門 1；來 1"], // 希 -> 來
                ["2025-12-13", "六", "使徒行傳 5", "來 2-11"], // 希 -> 來
                ["2025-12-14", "日", "使徒行傳 6", "來 12-13；雅 1-5；彼前 1-3"], // 希 -> 來
                ["2025-12-15", "一", "使徒行傳 7", "彼前 4-5；彼後 1-3；約一 1-5"],
                ["2025-12-16", "二", "以西結書 37", "約二；約三；猶；啟 1-7"],
                ["2025-12-17", "三", "以西結書 38", "啟 8-17"],
                ["2025-12-18", "四", "以西結書 39", "啟 18-22；創 1-5 (新循環)"],
                ["2025-12-19", "五", "以西結書 40", "創 6-15"],
                ["2025-12-20", "六", "使徒行傳 8", "創 16-25"],
                ["2025-12-21", "日", "使徒行傳 9", "創 26-35"],
                ["2025-12-22", "一", "使徒行傳 10", "創 36-45"],
                ["2025-12-23", "二", "以西結書 41", "創 46-50；出 1-5"],
                ["2025-12-24", "三", "以西結書 42", "出 6-15"],
                ["2025-12-25", "四", "以西結書 43", "出 16-25"],
                ["2025-12-26", "五", "以西結書 44", "出 26-35"],
                ["2025-12-27", "六", "使徒行傳 11", "出 36-40；利 1-5"],
                ["2025-12-28", "日", "使徒行傳 12", "利 6-15"],
                ["2025-12-29", "一", "使徒行傳 13", "利 16-25"],
                ["2025-12-30", "二", "以西結書 45", "利 26-27；民 1-8"],
                ["2025-12-31", "三", "以西結書 46", "民 9-18"]
            ];
            // 2026 Full
            const year2026 = [
                ["2026-01-01", "四", "結 47", "民 19-28"],
                ["2026-01-02", "五", "結 48 (卷終)", "民 29-36；申 1-2"],
                ["2026-01-03", "六", "徒 14", "申 3-12"],
                ["2026-01-04", "日", "徒 15", "申 13-22"],
                ["2026-01-05", "一", "徒 16", "申 23-32"],
                ["2026-01-06", "二", "但 1", "申 33-34；書 1-8"],
                ["2026-01-07", "三", "但 2", "書 9-18"],
                ["2026-01-08", "四", "但 3", "書 19-24；士 1-4"],
                ["2026-01-09", "五", "但 4", "士 5-14"],
                ["2026-01-10", "六", "徒 17", "士 15-21；得 1-3"],
                ["2026-01-11", "日", "徒 18", "得 4；撒上 1-9"],
                ["2026-01-12", "一", "徒 19", "撒上 10-19"],
                ["2026-01-13", "二", "但 5", "撒上 20-29"],
                ["2026-01-14", "三", "但 6", "撒上 30-31；撒下 1-8"],
                ["2026-01-15", "四", "但 7", "撒下 9-18"],
                ["2026-01-16", "五", "但 8", "撒下 19-24；王上 1-4"],
                ["2026-01-17", "六", "徒 20", "王上 5-14"],
                ["2026-01-18", "日", "徒 21", "王上 15-22；王下 1-2"],
                ["2026-01-19", "一", "徒 22", "王下 3-12"],
                ["2026-01-20", "二", "但 9", "王下 13-22"],
                ["2026-01-21", "三", "但 10", "王下 23-25；代上 1-7"],
                ["2026-01-22", "四", "但 11", "代上 8-17"],
                ["2026-01-23", "五", "但 12 (卷終)", "代上 18-27"],
                ["2026-01-24", "六", "徒 23", "代上 28-29；代下 1-8"],
                ["2026-01-25", "日", "徒 24", "代下 9-18"],
                ["2026-01-26", "一", "徒 25", "代下 19-28"],
                ["2026-01-27", "二", "何 1", "代下 29-36；拉 1-2"],
                ["2026-01-28", "三", "何 2", "拉 3-10；尼 1-2"],
                ["2026-01-29", "四", "何 3", "尼 3-12"],
                ["2026-01-30", "五", "何 4", "尼 13；斯 1-9"],
                ["2026-01-31", "六", "徒 26", "斯 10；伯 1-9"],
                ["2026-02-01", "日", "徒 27", "伯 10-19"],
                ["2026-02-02", "一", "徒 28 (卷終)", "伯 20-29"],
                ["2026-02-03", "二", "何 5", "伯 30-39"],
                ["2026-02-04", "三", "何 6", "伯 40-42；詩 1-7"],
                ["2026-02-05", "四", "何 7", "詩 8-17"],
                ["2026-02-06", "五", "何 8", "詩 18-27"],
                ["2026-02-07", "六", "羅 1", "詩 28-37"],
                ["2026-02-08", "日", "羅 2", "詩 38-47"],
                ["2026-02-09", "一", "羅 3", "詩 48-57"],
                ["2026-02-10", "二", "何 9", "詩 58-67"],
                ["2026-02-11", "三", "何 10", "詩 68-77"],
                ["2026-02-12", "四", "何 11", "詩 78-87"],
                ["2026-02-13", "五", "何 12", "詩 88-97"],
                ["2026-02-14", "六", "羅 4", "詩 98-107"],
                ["2026-02-15", "日", "羅 5", "詩 108-117"],
                ["2026-02-16", "一", "羅 6", "詩 118-127"],
                ["2026-02-17", "二", "何 13", "詩 128-137"],
                ["2026-02-18", "三", "何 14 (卷終)", "詩 138-147"],
                ["2026-02-19", "四", "珥 1", "詩 148-150；箴 1-7"],
                ["2026-02-20", "五", "珥 2", "箴 8-17"],
                ["2026-02-21", "六", "羅 7", "箴 18-27"],
                ["2026-02-22", "日", "羅 8", "箴 28-31；傳 1-6"],
                ["2026-02-23", "一", "羅 9", "傳 7-12；歌 1-4"],
                ["2026-02-24", "二", "珥 3 (卷終)", "歌 5-8；賽 1-6"],
                ["2026-02-25", "三", "摩 1", "賽 7-16"],
                ["2026-02-26", "四", "摩 2", "賽 17-26"],
                ["2026-02-27", "五", "摩 3", "賽 27-36"],
                ["2026-02-28", "六", "羅 10", "賽 37-46"],
                ["2026-03-01", "日", "羅 11", "賽 47-56"],
                ["2026-03-02", "一", "羅 12", "賽 57-66"],
                ["2026-03-03", "二", "摩 4", "耶 1-10"],
                ["2026-03-04", "三", "摩 5", "耶 11-20"],
                ["2026-03-05", "四", "摩 6", "耶 21-30"],
                ["2026-03-06", "五", "摩 7", "耶 31-40"],
                ["2026-03-07", "六", "羅 13", "耶 41-50"],
                ["2026-03-08", "日", "羅 14", "耶 51-52；哀 1-5；結 1-3"],
                ["2026-03-09", "一", "羅 15", "結 4-13"],
                ["2026-03-10", "二", "摩 8", "結 14-23"],
                ["2026-03-11", "三", "摩 9 (卷終)", "結 24-33"],
                ["2026-03-12", "四", "俄", "結 34-43"],
                ["2026-03-13", "五", "拿 1", "結 44-48；但 1-5"],
                ["2026-03-14", "六", "羅 16 (卷終)", "但 6-12；何 1-3"],
                ["2026-03-15", "日", "林前 1", "何 4-13"],
                ["2026-03-16", "一", "林前 2", "何 14；珥 1-3；摩 1-6"],
                ["2026-03-17", "二", "拿 2", "摩 7-9；俄；拿 1-4；彌 1-2"],
                ["2026-03-18", "三", "拿 3", "彌 3-7；鴻 1-3；哈 1-2"],
                ["2026-03-19", "四", "拿 4 (卷終)", "哈 3；番 1-3；該 1-2；亞 1-4"],
                ["2026-03-20", "五", "彌 1", "亞 5-14"],
                ["2026-03-21", "六", "林前 3", "瑪 1-4；太 1-6"],
                ["2026-03-22", "日", "林前 4", "太 7-16"],
                ["2026-03-23", "一", "林前 5", "太 17-26"],
                ["2026-03-24", "二", "彌 2", "太 27-28；可 1-8"],
                ["2026-03-25", "三", "彌 3", "可 9-16；路 1-2"],
                ["2026-03-26", "四", "彌 4", "路 3-12"],
                ["2026-03-27", "五", "彌 5", "路 13-22"],
                ["2026-03-28", "六", "林前 6", "路 23-24；約 1-8"],
                ["2026-03-29", "日", "林前 7", "約 9-18"],
                ["2026-03-30", "一", "林前 8", "約 19-21；徒 1-7"],
                ["2026-03-31", "二", "彌 6", "徒 8-17"],
                ["2026-04-01", "三", "彌 7 (卷終)", "徒 18-27"],
                ["2026-04-02", "四", "鴻 1", "徒 28；羅 1-9"],
                ["2026-04-03", "五", "鴻 2", "羅 10-16；林前 1-3"],
                ["2026-04-04", "六", "林前 9", "林前 4-13"],
                ["2026-04-05", "日", "林前 10", "林前 14-16；林後 1-7"],
                ["2026-04-06", "一", "林前 11", "林後 8-13；加 1-4"],
                ["2026-04-07", "二", "鴻 3 (卷終)", "加 5-6；弗 1-6；腓 1-2"],
                ["2026-04-08", "三", "哈 1", "腓 3-4；歌 1-4；帖前 1-4"],
                ["2026-04-09", "四", "哈 2", "帖前 5；帖後 1-3；提前 1-6"],
                ["2026-04-10", "五", "哈 3 (卷終)", "提後 1-4；多 1-3；門；來 1-2"], // 希 -> 來
                ["2026-04-11", "六", "林前 12", "來 3-12"], // 希 -> 來
                ["2026-04-12", "日", "林前 13", "來 13；雅 1-5；彼前 1-4"], // 希 -> 來
                ["2026-04-13", "一", "林前 14", "彼前 5；彼後 1-3；約一 1-5；約二"],
                ["2026-04-14", "二", "番 1", "約三；猶；啟 1-8"],
                ["2026-04-15", "三", "番 2", "啟 9-18"],
                ["2026-04-16", "四", "番 3 (卷終)", "啟 19-22；創 1-6 (第一遍讀完)"],
                ["2026-04-17", "五", "該 1", "創 7-16"],
                ["2026-04-18", "六", "林前 15", "創 17-26"],
                ["2026-04-19", "日", "林前 16 (卷終)", "創 27-36"],
                ["2026-04-20", "一", "林後 1", "創 37-46"],
                ["2026-04-21", "二", "該 2 (卷終)", "創 47-50；出 1-6"],
                ["2026-04-22", "三", "亞 1", "出 7-16"],
                ["2026-04-23", "四", "亞 2", "出 17-26"],
                ["2026-04-24", "五", "亞 3", "出 27-36"],
                ["2026-04-25", "六", "林後 2", "出 37-40；利 1-6"],
                ["2026-04-26", "日", "林後 3", "利 7-16"],
                ["2026-04-27", "一", "林後 4", "利 17-26"],
                ["2026-04-28", "二", "亞 4", "利 27；民 1-9"],
                ["2026-04-29", "三", "亞 5", "民 10-19"],
                ["2026-04-30", "四", "亞 6", "民 20-29"],
                ["2026-05-01", "五", "亞 7", "民 30-36；申 1-3"],
                ["2026-05-02", "六", "林後 5", "申 4-13"],
                ["2026-05-03", "日", "林後 6", "申 14-23"],
                ["2026-05-04", "一", "林後 7", "申 24-33"],
                ["2026-05-05", "二", "亞 8", "申 34；書 1-9"],
                ["2026-05-06", "三", "亞 9", "書 10-19"],
                ["2026-05-07", "四", "亞 10", "書 20-24；士 1-5"],
                ["2026-05-08", "五", "亞 11", "士 6-15"],
                ["2026-05-09", "六", "林後 8", "士 16-21；得 1-4"],
                ["2026-05-10", "日", "林後 9", "撒上 1-10"],
                ["2026-05-11", "一", "林後 10", "撒上 11-20"],
                ["2026-05-12", "二", "亞 12", "撒上 21-30"],
                ["2026-05-13", "三", "亞 13", "撒上 31；撒下 1-9"],
                ["2026-05-14", "四", "亞 14 (卷終)", "撒下 10-19"],
                ["2026-05-15", "五", "瑪 1", "撒下 20-24；王上 1-5"],
                ["2026-05-16", "六", "林後 11", "王上 6-15"],
                ["2026-05-17", "日", "林後 12", "王上 16-22；王下 1-3"],
                ["2026-05-18", "一", "林後 13 (卷終)", "王下 4-13"],
                ["2026-05-19", "二", "瑪 2", "王下 14-23"],
                ["2026-05-20", "三", "瑪 3", "王下 24-25；代上 1-8"],
                ["2026-05-21", "四", "瑪 4 (舊約一遍終)", "代上 9-18"],
                ["2026-05-22", "五", "創 1 (新循環)", "代上 19-28"],
                ["2026-05-23", "六", "加 1", "代上 29；代下 1-9"],
                ["2026-05-24", "日", "加 2", "代下 10-19"],
                ["2026-05-25", "一", "加 3", "代下 20-29"],
                ["2026-05-26", "二", "創 2", "代下 30-36；拉 1-3"],
                ["2026-05-27", "三", "創 3", "拉 4-10；尼 1-3"],
                ["2026-05-28", "四", "創 4", "尼 4-13"],
                ["2026-05-29", "五", "創 5", "斯 1-10"],
                ["2026-05-30", "六", "加 4", "伯 1-10"],
                ["2026-05-31", "日", "加 5", "伯 11-20"],
                ["2026-06-01", "一", "加 6 (卷終)", "伯 21-30"],
                ["2026-06-02", "二", "創 6", "伯 31-40"],
                ["2026-06-03", "三", "創 7", "伯 41-42；詩 1-8"],
                ["2026-06-04", "四", "創 8", "詩 9-18"],
                ["2026-06-05", "五", "創 9", "詩 19-28"],
                ["2026-06-06", "六", "弗 1", "詩 29-38"],
                ["2026-06-07", "日", "弗 2", "詩 39-48"],
                ["2026-06-08", "一", "弗 3", "詩 49-58"],
                ["2026-06-09", "二", "創 10", "詩 59-68"],
                ["2026-06-10", "三", "創 11", "詩 69-78"],
                ["2026-06-11", "四", "創 12", "詩 79-88"],
                ["2026-06-12", "五", "創 13", "詩 89-98"],
                ["2026-06-13", "六", "弗 4", "詩 99-108"],
                ["2026-06-14", "日", "弗 5", "詩 109-118"],
                ["2026-06-15", "一", "弗 6 (卷終)", "詩 119-128"],
                ["2026-06-16", "二", "創 14", "詩 129-138"],
                ["2026-06-17", "三", "創 15", "詩 139-148"],
                ["2026-06-18", "四", "創 16", "詩 149-150；箴 1-8"],
                ["2026-06-19", "五", "創 17", "箴 9-18"],
                ["2026-06-20", "六", "腓 1", "箴 19-28"],
                ["2026-06-21", "日", "腓 2", "箴 29-31；傳 1-7"],
                ["2026-06-22", "一", "腓 3", "傳 8-12；歌 1-5"],
                ["2026-06-23", "二", "創 18", "歌 6-8；賽 1-7"],
                ["2026-06-24", "三", "創 19", "賽 8-17"],
                ["2026-06-25", "四", "創 20", "賽 18-27"],
                ["2026-06-26", "五", "創 21", "賽 28-37"],
                ["2026-06-27", "六", "腓 4 (卷終)", "賽 38-47"],
                ["2026-06-28", "日", "西 1", "賽 48-57"],
                ["2026-06-29", "一", "西 2", "賽 58-66；耶 1"],
                ["2026-06-30", "二", "創 22", "耶 2-11"],
                ["2026-07-01", "三", "創 23", "耶 12-21"],
                ["2026-07-02", "四", "創 24", "耶 22-31"],
                ["2026-07-03", "五", "創 25", "耶 32-41"],
                ["2026-07-04", "六", "西 3", "耶 42-51"],
                ["2026-07-05", "日", "西 4 (卷終)", "耶 52；哀 1-5；結 1-4"],
                ["2026-07-06", "一", "帖前 1", "結 5-14"],
                ["2026-07-07", "二", "創 26", "結 15-24"],
                ["2026-07-08", "三", "創 27", "結 25-34"],
                ["2026-07-09", "四", "創 28", "結 35-44"],
                ["2026-07-10", "五", "創 29", "結 45-48；但 1-6"],
                ["2026-07-11", "六", "帖前 2", "但 7-12；何 1-4"],
                ["2026-07-12", "日", "帖前 3", "何 5-14"],
                ["2026-07-13", "一", "帖前 4", "珥 1-3；摩 1-7"],
                ["2026-07-14", "二", "創 30", "摩 8-9；俄；拿；彌 1-3"],
                ["2026-07-15", "三", "創 31", "彌 4-7；鴻 1-3；哈 1-3"],
                ["2026-07-16", "四", "創 32", "番 1-3；該 1-2；亞 1-5"],
                ["2026-07-17", "五", "創 33", "亞 6-14；瑪 1"],
                ["2026-07-18", "六", "帖前 5 (卷終)", "瑪 2-4；太 1-7"],
                ["2026-07-19", "日", "帖後 1", "太 8-17"],
                ["2026-07-20", "一", "帖後 2", "太 18-27"],
                ["2026-07-21", "二", "創 34", "太 28；可 1-9"],
                ["2026-07-22", "三", "創 35", "可 10-16；路 1-3"],
                ["2026-07-23", "四", "創 36", "路 4-13"],
                ["2026-07-24", "五", "創 37", "路 14-23"],
                ["2026-07-25", "六", "帖後 3 (卷終)", "路 24；約 1-9"],
                ["2026-07-26", "日", "提前 1", "約 10-19"],
                ["2026-07-27", "一", "提前 2", "約 20-21；徒 1-8"],
                ["2026-07-28", "二", "創 38", "徒 9-18"],
                ["2026-07-29", "三", "創 39", "徒 19-28"],
                ["2026-07-30", "四", "創 40", "羅 1-10"],
                ["2026-07-31", "五", "創 41", "羅 11-16；林前 1-4"],
                ["2026-08-01", "六", "提前 3", "林前 5-14"],
                ["2026-08-02", "日", "提前 4", "林前 15-16；林後 1-8"],
                ["2026-08-03", "一", "提前 5", "林後 9-13；加 1-5"],
                ["2026-08-04", "二", "創 42", "加 6；弗 1-6；腓 1-3"],
                ["2026-08-05", "三", "創 43", "腓 4；歌 1-4；帖前 1-5"],
                ["2026-08-06", "四", "創 44", "帖後 1-3；提前 1-6；提後 1"],
                ["2026-08-07", "五", "創 45", "提後 2-4；多 1-3；門；來 1-3"], // 希 -> 來
                ["2026-08-08", "六", "提前 6 (卷終)", "來 4-13"], // 希 -> 來
                ["2026-08-09", "日", "提後 1", "雅 1-5；彼前 1-5"],
                ["2026-08-10", "一", "提後 2", "彼後 1-3；約一 1-5；約二；約三"],
                ["2026-08-11", "二", "創 46", "猶；啟 1-9"],
                ["2026-08-12", "三", "創 47", "啟 10-19"],
                ["2026-08-13", "四", "創 48", "啟 20-22；創 1-7 (第三遍讀完)"],
                ["2026-08-14", "五", "創 49", "創 8-17"],
                ["2026-08-15", "六", "提後 3", "創 18-27"],
                ["2026-08-16", "日", "提後 4 (卷終)", "創 28-37"],
                ["2026-08-17", "一", "多 1", "創 38-47"],
                ["2026-08-18", "二", "創 50 (卷終)", "創 48-50；出 1-7"],
                ["2026-08-19", "三", "出 1", "出 8-17"],
                ["2026-08-20", "四", "出 2", "出 18-27"],
                ["2026-08-21", "五", "出 3", "出 28-37"],
                ["2026-08-22", "六", "多 2", "出 38-40；利 1-7"],
                ["2026-08-23", "日", "多 3 (卷終)", "利 8-17"],
                ["2026-08-24", "一", "門", "利 18-27"],
                ["2026-08-25", "二", "出 4", "民 1-10"],
                ["2026-08-26", "三", "出 5", "民 11-20"],
                ["2026-08-27", "四", "出 6", "民 21-30"],
                ["2026-08-28", "五", "出 7", "民 31-36；申 1-4"],
                ["2026-08-29", "六", "希 1", "申 5-14"], // 此處維持全名或簡稱，後續 formatCalendarDisplay 會處理
                ["2026-08-30", "日", "希 2", "申 15-24"],
                ["2026-08-31", "一", "希 3", "申 25-34"],
                ["2026-09-01", "二", "出 8", "書 1-10"],
                ["2026-09-02", "三", "出 9", "書 11-20"],
                ["2026-09-03", "四", "出 10", "書 21-24；士 1-6"],
                ["2026-09-04", "五", "出 11", "士 7-16"],
                ["2026-09-05", "六", "希 4", "士 17-21；得 1-4；撒上 1"],
                ["2026-09-06", "日", "希 5", "撒上 2-11"],
                ["2026-09-07", "一", "希 6", "撒上 12-21"],
                ["2026-09-08", "二", "出 12", "撒上 22-31"],
                ["2026-09-09", "三", "出 13", "撒下 1-10"],
                ["2026-09-10", "四", "出 14", "撒下 11-20"],
                ["2026-09-11", "五", "出 15", "撒下 21-24；王上 1-6"],
                ["2026-09-12", "六", "希 7", "王上 7-16"],
                ["2026-09-13", "日", "希 8", "王上 17-22；王下 1-4"],
                ["2026-09-14", "一", "希 9", "王下 5-14"],
                ["2026-09-15", "二", "出 16", "王下 15-24"],
                ["2026-09-16", "三", "出 17", "王下 25；代上 1-9"],
                ["2026-09-17", "四", "出 18", "代上 10-19"],
                ["2026-09-18", "五", "出 19", "代上 20-29"],
                ["2026-09-19", "六", "希 10", "代下 1-10"],
                ["2026-09-20", "日", "希 11", "代下 11-20"],
                ["2026-09-21", "一", "希 12", "代下 21-30"],
                ["2026-09-22", "二", "出 20", "代下 31-36；拉 1-4"],
                ["2026-09-23", "三", "出 21", "拉 5-10；尼 1-4"],
                ["2026-09-24", "四", "出 22", "尼 5-13；斯 1"],
                ["2026-09-25", "五", "出 23", "斯 2-10；伯 1"],
                ["2026-09-26", "六", "希 13 (卷終)", "伯 2-11"],
                ["2026-09-27", "日", "雅 1", "伯 12-21"],
                ["2026-09-28", "一", "雅 2", "伯 22-31"],
                ["2026-09-29", "二", "出 24", "伯 32-41"],
                ["2026-09-30", "三", "出 25", "伯 42；詩 1-9"],
                ["2026-10-01", "四", "出 26", "詩 10-19"],
                ["2026-10-02", "五", "出 27", "詩 20-29"],
                ["2026-10-03", "六", "雅 3", "詩 30-39"],
                ["2026-10-04", "日", "雅 4", "詩 40-49"],
                ["2026-10-05", "一", "雅 5 (卷終)", "詩 50-59"],
                ["2026-10-06", "二", "出 28", "詩 60-69"],
                ["2026-10-07", "三", "出 29", "詩 70-79"],
                ["2026-10-08", "四", "出 30", "詩 80-89"],
                ["2026-10-09", "五", "出 31", "詩 90-99"],
                ["2026-10-10", "六", "彼前 1", "詩 100-109"],
                ["2026-10-11", "日", "彼前 2", "詩 110-119"],
                ["2026-10-12", "一", "彼前 3", "詩 120-129"],
                ["2026-10-13", "二", "出 32", "詩 130-139"],
                ["2026-10-14", "三", "出 33", "詩 140-149"],
                ["2026-10-15", "四", "出 34", "詩 150；箴 1-9"],
                ["2026-10-16", "五", "出 35", "箴 10-19"],
                ["2026-10-17", "六", "彼前 4", "箴 20-29"],
                ["2026-10-18", "日", "彼前 5 (卷終)", "箴 30-31；傳 1-8"],
                ["2026-10-19", "一", "彼後 1", "傳 9-12；歌 1-6"],
                ["2026-10-20", "二", "出 36", "歌 7-8；賽 1-8"],
                ["2026-10-21", "三", "出 37", "賽 9-18"],
                ["2026-10-22", "四", "出 38", "賽 19-28"],
                ["2026-10-23", "五", "出 39", "賽 29-38"],
                ["2026-10-24", "六", "彼後 2", "賽 39-48"],
                ["2026-10-25", "日", "彼後 3 (卷終)", "賽 49-58"],
                ["2026-10-26", "一", "約一 1", "賽 59-66；耶 1-2"],
                ["2026-10-27", "二", "出 40 (卷終)", "耶 3-12"],
                ["2026-10-28", "三", "利 1", "耶 13-22"],
                ["2026-10-29", "四", "利 2", "耶 23-32"],
                ["2026-10-30", "五", "利 3", "耶 33-42"],
                ["2026-10-31", "六", "約一 2", "耶 43-52"],
                ["2026-11-01", "日", "約一 3", "哀 1-5；結 1-5"],
                ["2026-11-02", "一", "約一 4", "結 6-15"],
                ["2026-11-03", "二", "利 4", "結 16-25"],
                ["2026-11-04", "三", "利 5", "結 26-35"],
                ["2026-11-05", "四", "利 6", "結 36-45"],
                ["2026-11-06", "五", "利 7", "結 46-48；但 1-7"],
                ["2026-11-07", "六", "約一 5 (卷終)", "但 8-12；何 1-5"],
                ["2026-11-08", "日", "約二", "何 6-14；珥 1"],
                ["2026-11-09", "一", "約三", "珥 2-3；摩 1-8"],
                ["2026-11-10", "二", "利 8", "摩 9；俄；拿；彌 1-4"],
                ["2026-11-11", "三", "利 9", "彌 5-7；鴻；哈；番 1-2"],
                ["2026-11-12", "四", "利 10", "番 3；該；亞 1-7"],
                ["2026-11-13", "五", "利 11", "亞 8-14；瑪 1-3"],
                ["2026-11-14", "六", "猶", "瑪 4；太 1-9"],
                ["2026-11-15", "日", "啟 1", "太 10-19"],
                ["2026-11-16", "一", "啟 2", "太 20-29"],
                ["2026-11-17", "二", "利 12", "太 30；可 1-9"],
                ["2026-11-18", "三", "利 13", "可 10-16；路 1-3"],
                ["2026-11-19", "四", "利 14", "路 4-13"],
                ["2026-11-20", "五", "利 15", "路 14-23"],
                ["2026-11-21", "六", "啟 3", "路 24；約 1-9"],
                ["2026-11-22", "日", "啟 4", "約 10-19"],
                ["2026-11-23", "一", "啟 5", "約 20-21；徒 1-8"],
                ["2026-11-24", "二", "利 16", "徒 9-18"],
                ["2026-11-25", "三", "利 17", "徒 19-28"],
                ["2026-11-26", "四", "利 18", "羅 1-10"],
                ["2026-11-27", "五", "利 19", "羅 11-16；林前 1-4"],
                ["2026-11-28", "六", "啟 6", "林前 5-14"],
                ["2026-11-29", "日", "啟 7", "林前 15-16；林後 1-8"],
                ["2026-11-30", "一", "啟 8", "林後 9-13；加 1-5"],
                ["2026-12-01", "二", "利 20", "加 6；弗 1-6；腓 1-3"],
                ["2026-12-02", "三", "利 21", "腓 4；歌 1-4；帖前 1-5"],
                ["2026-12-03", "四", "利 22", "帖後 1-3；提前 1-6；提後 1"],
                ["2026-12-04", "五", "利 23", "提後 2-4；多 1-3；門；來 1-3"], // 希 -> 來
                ["2026-12-05", "六", "啟 9", "來 4-13"], // 希 -> 來
                ["2026-12-06", "日", "啟 10", "雅 1-5；彼前 1-5"],
                ["2026-12-07", "一", "啟 11", "彼後；約一；約二；約三"],
                ["2026-12-08", "二", "利 24", "猶；啟 1-9"],
                ["2026-12-09", "三", "利 25", "啟 10-19"],
                ["2026-12-10", "四", "利 26", "啟 20-22；創 1-7 (第三遍讀完)"],
                ["2026-12-11", "五", "利 27 (卷終)", "創 8-17"],
                ["2026-12-12", "六", "啟 12", "創 18-27"],
                ["2026-12-13", "日", "啟 13", "創 28-37"],
                ["2026-12-14", "一", "啟 14", "創 38-47"],
                ["2026-12-15", "二", "民 1", "創 48-50；出 1-7"],
                ["2026-12-16", "三", "民 2", "出 8-17"],
                ["2026-12-17", "四", "民 3", "出 18-27"],
                ["2026-12-18", "五", "民 4", "出 28-37"],
                ["2026-12-19", "六", "啟 15", "出 38-40；利 1-7"],
                ["2026-12-20", "日", "啟 16", "利 8-17"],
                ["2026-12-21", "一", "啟 17", "利 18-27"],
                ["2026-12-22", "二", "民 5", "民 1-10"],
                ["2026-12-23", "三", "民 6", "民 11-20"],
                ["2026-12-24", "四", "民 7", "民 21-30"],
                ["2026-12-25", "五", "民 8", "民 31-36；申 1-4"],
                ["2026-12-26", "六", "啟 18", "申 5-14"],
                ["2026-12-27", "日", "啟 19", "申 15-24"],
                ["2026-12-28", "一", "啟 20", "申 25-34"],
                ["2026-12-29", "二", "民 9", "書 1-10"],
                ["2026-12-30", "三", "民 10", "書 11-20"],
                ["2026-12-31", "四", "民 11", "書 21-24；士 1-6"]
            ];
            year2025_Dec.forEach(d => addDay(d[0], d[1], d[2], d[3]));
            year2026.forEach(d => addDay(d[0], d[1], d[2], d[3]));
            return plans;
        };

        const BibleReader = ({ bookId, chapter, label, lang }) => {
            const [content, setContent] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                const fetchScripture = async () => {
                    setLoading(true);
                    setError(null);
                    if (!bookId || !chapter) {
                        setError(lang === 'zh' ? "無法識別經文" : "Unknown Reference");
                        setLoading(false);
                        return;
                    }
                    try {
                        const version = lang === 'en' ? 'WEB' : 'CUV';
                        const response = await fetch(`https://bolls.life/get-chapter/${version}/${bookId}/${chapter}/`);
                        if (!response.ok) throw new Error("API Error");
                        const data = await response.json();
                        if (!Array.isArray(data)) throw new Error("Format Error");
                        setContent(data);
                    } catch (err) {
                        setError(lang === 'zh' ? "載入失敗，請檢查網路。" : "Failed to load scripture.");
                    } finally {
                        setLoading(false);
                    }
                };
                fetchScripture();
            }, [bookId, chapter, lang]);

            const t = TRANSLATIONS[lang];

            if (loading) return (
                <div className="flex flex-col items-center justify-center p-8 text-gray-400 gap-2 min-h-[150px] bg-gray-50 rounded-lg">
                    <RefreshCw className="animate-spin" size={24} />
                    <span className="text-sm">{t.loading}</span>
                </div>
            );

            if (error) return <div className="p-6 text-center text-red-500 bg-red-50 rounded-lg"><p>{error}</p></div>;

            return (
                <div className="bg-[#fffdf7] rounded-xl border border-gray-200 shadow-inner max-h-[60vh] flex flex-col mt-4 animate-in slide-in-from-top-2 fade-in overflow-hidden">
                    {/* Fixed Header */}
                    <div className="flex-none p-4 border-b border-gray-200 bg-[#fffdf7] z-10 flex justify-between items-center">
                        <h3 className="text-xl font-bold text-gray-800">
                            {label} 
                        </h3>
                        <span className="text-xs font-normal text-gray-400">({t.version})</span>
                    </div>
                    
                    {/* Scrollable Content */}
                    <div className="flex-1 overflow-y-auto p-6 custom-scrollbar">
                        <div className="text-lg leading-relaxed text-gray-700 space-y-2 font-serif">
                            {content.map((v) => (
                                <div key={v.pk} className="flex gap-2 hover:bg-yellow-50/50 p-0.5 rounded transition-colors">
                                    <span className="text-xs text-gray-400 font-sans mt-1.5 w-6 text-right shrink-0 select-none">{v.verse}</span>
                                    <p className="flex-1">{v.text}</p>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // --- 全新的預覽與列印組件 (PrintPreviewOverlay) ---
        const PrintPreviewOverlay = ({ year, selectedMonths, plans, lang, onClose }) => {
            const t = TRANSLATIONS[lang];
            const contentRef = useRef(null);
            const [isGenerating, setIsGenerating] = useState(false);
            
            // 根據選取的月份生成資料
            const pagesData = useMemo(() => {
                return selectedMonths.sort((a,b) => a-b).map(month => {
                    const prefix = `${year}-${String(month).padStart(2,'0')}`;
                    const monthPlans = plans.filter(p => p.date.startsWith(prefix));
                    return { month, plans: monthPlans };
                });
            }, [year, selectedMonths, plans]);

            const handlePrint = () => {
                if (!contentRef.current) return;

                // 開啟新視窗
                const printWindow = window.open('', '_blank');
                if (!printWindow) {
                    alert("請允許本網站開啟彈跳視窗以進行列印");
                    return;
                }

                // 獲取當前頁面的樣式 (包含 Google Fonts 和自定義 CSS)
                // 這裡特別抓取所有的 style 標籤和 link 標籤
                const styles = Array.from(document.querySelectorAll('style, link[rel="stylesheet"]'))
                    .map(style => style.outerHTML)
                    .join('\n');
                
                // 獲取預覽區域的 HTML
                const content = contentRef.current.innerHTML;

                // 寫入新視窗
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>PJBC Schedule Print</title>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        
                        <!-- 重新引入 Tailwind (確保樣式正確) -->
                        <script src="https://cdn.tailwindcss.com"><\/script>
                        <script>
                            tailwind.config = {
                                theme: {
                                    extend: {
                                        screens: { 'print': {'raw': 'print'} }
                                    }
                                }
                            }
                        <\/script>

                        <!-- 引入原有的樣式 (包含 Font, Custom CSS) -->
                        ${styles}

                        <style>
                            /* 強制覆蓋：列印視窗的基礎設定 */
                            body { 
                                background-color: white !important; 
                                margin: 0; 
                                padding: 0;
                                -webkit-print-color-adjust: exact !important; 
                                print-color-adjust: exact !important; 
                            }
                            
                            /* 隱藏預覽介面中不該出現的捲軸等 */
                            ::-webkit-scrollbar { display: none; }
                        </style>
                    </head>
                    <body>
                        <div id="print-preview-root" style="position: static; width: 100%; height: auto; overflow: visible;">
                            ${content}
                        </div>
                        <script>
                            // 等待資源載入後執行列印
                            window.onload = function() {
                                setTimeout(function() {
                                    window.print();
                                    // window.close(); // 選擇性開啟自動關閉
                                }, 800);
                            };
                        <\/script>
                    </body>
                    </html>
                `);
                printWindow.document.close(); // 必須調用，否則某些瀏覽器載入指示器會一直轉
            };

            const handleDownloadAllPNGs = async () => {
                if (!contentRef.current) return;
                setIsGenerating(true);
                try {
                    const pages = contentRef.current.querySelectorAll('.print-page-container');
                    
                    // 單張圖片直接下載
                    if (pages.length === 1) {
                        const page = pages[0];
                        const canvas = await html2canvas(page, { scale: 2 });
                        const link = document.createElement('a');
                        const month = pagesData[0] ? pagesData[0].month : 1;
                        link.download = `PJBC_Schedule_${year}_${month}.png`;
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                    } 
                    // 多張圖片打包成 ZIP
                    else if (pages.length > 1) {
                        const zip = new JSZip();
                        
                        // 依序處理每一頁
                        for (let i = 0; i < pages.length; i++) {
                            const page = pages[i];
                            // 讓瀏覽器有機會渲染畫面進度，避免無回應
                            await new Promise(r => setTimeout(r, 100));
                            
                            const canvas = await html2canvas(page, { scale: 2 });
                            const imgData = canvas.toDataURL('image/png');
                            
                            // 去除 Data URL 前綴 (data:image/png;base64,) 以便存入 zip
                            const base64Data = imgData.split(',')[1];
                            
                            const month = pagesData[i] ? pagesData[i].month : (i + 1);
                            // 檔名：PJBC_Schedule_2025_1.png
                            zip.file(`PJBC_Schedule_${year}_${month}.png`, base64Data, { base64: true });
                        }
                        
                        // 生成 ZIP 並觸發下載
                        const content = await zip.generateAsync({ type: "blob" });
                        const link = document.createElement('a');
                        link.href = window.URL.createObjectURL(content);
                        link.download = `PJBC_Schedule_${year}_Images.zip`;
                        link.click();
                    }
                } catch (err) {
                    console.error("PNG/ZIP Generation failed", err);
                    alert("圖片生成失敗，請重試");
                } finally {
                    setIsGenerating(false);
                }
            };

            const handleDownloadPDF = async () => {
                if (!contentRef.current) return;
                setIsGenerating(true);
                try {
                    const element = contentRef.current;
                    const opt = {
                        margin: 0, 
                        filename: `PJBC_Schedule_${year}.pdf`,
                        image: { type: 'jpeg', quality: 0.98 },
                        html2canvas: { scale: 2 },
                        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                    };
                    await html2pdf().set(opt).from(element).save();
                } catch (err) {
                    console.error("PDF Generation failed", err);
                    alert("PDF 生成失敗，請重試");
                } finally {
                    setIsGenerating(false);
                }
            };

            return (
                <div className="fixed inset-0 z-[9999] bg-gray-100 overflow-auto flex flex-col">
                    {/* 控制列 (列印時隱藏) */}
                    <div className="no-print-in-preview sticky top-0 bg-gray-900 text-white p-4 shadow-md flex flex-wrap justify-between items-center z-50 gap-4">
                        <div className="font-bold flex items-center gap-2 text-lg">
                            <FileText size={24} className="text-blue-400"/> {t.print_preview_btn}
                        </div>
                        <div className="flex flex-wrap gap-2 md:gap-3">
                            {isGenerating ? (
                                <div className="px-4 py-2 text-gray-300 flex items-center gap-2">
                                    <RefreshCw className="animate-spin" size={16}/> Processing...
                                </div>
                            ) : (
                                <>
                                    <button onClick={handleDownloadAllPNGs} className="px-3 md:px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors flex items-center gap-2 border border-gray-600">
                                        <ImageIcon size={16}/> <span className="hidden md:inline">{t.download_png}</span>
                                    </button>
                                    <button onClick={handleDownloadPDF} className="px-3 md:px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded text-sm transition-colors flex items-center gap-2 shadow-sm">
                                        <FileDown size={16}/> {t.download_pdf}
                                    </button>
                                    <button onClick={handlePrint} className="px-3 md:px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded text-sm shadow-lg transition-all flex items-center gap-2">
                                        <Printer size={16}/> {t.print_now}
                                    </button>
                                </>
                            )}
                            <div className="w-px h-8 bg-gray-700 mx-1 hidden md:block"></div>
                            <button onClick={onClose} className="px-3 md:px-4 py-2 bg-red-600/90 hover:bg-red-500 rounded text-sm transition-colors flex items-center gap-2 text-white">
                                <X size={16}/> {t.close_preview}
                            </button>
                        </div>
                    </div>

                    {/* 預覽內容 (實際列印區域) */}
                    <div className="flex-1 p-4 md:p-8 print:p-0 flex justify-center print:block overflow-x-hidden bg-gray-200">
                        <div ref={contentRef} className="print:w-full">
                            {pagesData.map((page, idx) => {
                                // 計算月份標籤
                                const monthLabel = lang === 'en' 
                                    ? ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"][page.month - 1]
                                    : page.month;
                                
                                // 針對英文月份調整字體大小，避免與上方橫線重疊
                                const monthFontSize = lang === 'en' ? '24px' : '36px';
                                
                                // 針對中文月份調整 top 位置，使其位於格線上方 (14mm)
                                // 英文維持原位 (22mm)
                                const metaTop = lang === 'en' ? '22mm' : '14mm';

                                return (
                                <div key={page.month} className="print-page-container">
                                    
                                    {/* 裝飾性標題區 */}
                                    <div className="print-header">
                                        <div className="print-title">{t.title}</div>
                                        <div className="print-subtitle">{t.print_subtitle}</div>
                                        <div className="print-meta" style={{ top: metaTop }}>
                                            <div className="print-meta-year">{year} {t.year}</div>
                                            <div className="print-meta-month" style={{fontSize: monthFontSize}}>{monthLabel} <span style={{fontSize:'16px', fontWeight:'normal'}}>{t.month}</span></div>
                                        </div>
                                    </div>

                                    {/* 表格 */}
                                    <div className="table-wrapper">
                                        <table className="design-table">
                                            <thead>
                                                <tr>
                                                    <th style={{width: '12%'}}>{t.date_col}</th>
                                                    <th style={{width: '30%'}}>{t.daily_one}</th>
                                                    <th style={{width: '6%'}}>{t.check_col}</th>
                                                    <th style={{width: '46%'}}>{t.daily_ten}</th>
                                                    <th style={{width: '6%'}}>{t.check_col}</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {page.plans.map((p, idx) => (
                                                    <tr key={p.date}>
                                                        <td className="cell-date">
                                                            {/* 移除星期旁的括號 */}
                                                            {parseInt(p.date.split('-')[2])} <span className="cell-weekday">{lang === 'en' ? WEEKDAY_MAP[p.weekday] : p.weekday}</span>
                                                        </td>
                                                        <td className="cell-scripture pl-2">
                                                            {formatScriptureDisplay(p.dailyOne, lang)}
                                                        </td>
                                                        <td className="cell-check">
                                                            <div className="design-checkbox"></div>
                                                        </td>
                                                        <td className="cell-scripture text-gray-700 pl-2">
                                                            {formatScriptureDisplay(p.dailyTen, lang)}
                                                        </td>
                                                        <td className="cell-check">
                                                            <div className="design-checkbox"></div>
                                                        </td>
                                                    </tr>
                                                ))}
                                                {/* 自動填補空行以維持滿版高度 */}
                                                {Array.from({length: 31 - page.plans.length}).map((_, i) => (
                                                    <tr key={`empty-${i}`}>
                                                        <td className="cell-date text-gray-200">-</td>
                                                        <td></td>
                                                        <td className="cell-check"><div className="design-checkbox opacity-20"></div></td>
                                                        <td></td>
                                                        <td className="cell-check"><div className="design-checkbox opacity-20"></div></td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    {/* 頁尾 */}
                                    <div className="print-footer">
                                         <div>PJBC Bible Reading Schedule</div>
                                         <div className="flex items-center gap-1">
                                            <Fish size={12} />
                                            <span>水深之處，下網打魚</span>
                                         </div>
                                    </div>
                                </div>
                            )})}
                        </div>
                    </div>
                </div>
            );
        };

        // --- 列印設定彈窗 (支援複選月份) ---
        const PrintModal = ({ isOpen, onClose, onConfirm, availableYears, lang }) => {
            const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());
            // 修改：預設月份為空陣列，不勾選任何月份
            const [selectedMonths, setSelectedMonths] = useState([]);
            const t = TRANSLATIONS[lang];

            if (!isOpen) return null;

            const toggleMonth = (m) => {
                setSelectedMonths(prev => 
                    prev.includes(m) ? prev.filter(x => x !== m) : [...prev, m]
                );
            };
            
            const selectAll = () => setSelectedMonths(Array.from({length:12}, (_,i)=>i+1));
            const deselectAll = () => setSelectedMonths([]);

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in no-print">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden flex flex-col animate-in zoom-in-95 border border-gray-100">
                        <div className="p-5 pb-4 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                            <h3 className="font-bold text-lg text-gray-800 flex items-center gap-2">
                                <Printer size={20} className="text-[#1E3A8A]" />
                                {t.print_modal_title}
                            </h3>
                            <button onClick={onClose} className="p-1 hover:bg-gray-200 rounded-full text-gray-500 transition-colors"><X size={20}/></button>
                        </div>
                        
                        <div className="p-6 space-y-6">
                            <p className="text-sm text-gray-600 leading-relaxed bg-blue-50 p-3 rounded-lg border border-blue-100">
                                {t.print_desc}
                            </p>
                            
                            {/* 年份選擇 */}
                            <div>
                                <label className="block text-xs font-bold text-gray-500 mb-2 uppercase tracking-wider">{t.year}</label>
                                <div className="flex gap-2">
                                    {availableYears.map(y => (
                                        <button 
                                            key={y}
                                            onClick={() => setSelectedYear(y)}
                                            className={`flex-1 py-2 rounded-lg font-bold border transition-all ${selectedYear === y ? 'bg-[#1E3A8A] text-white border-[#1E3A8A] shadow-md' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`}
                                        >
                                            {y}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* 月份選擇 (Grid) */}
                            <div>
                                <div className="flex justify-between items-center mb-2">
                                    <label className="block text-xs font-bold text-gray-500 uppercase tracking-wider">{t.month}</label>
                                    <div className="flex gap-2">
                                        <button onClick={selectAll} className="text-[10px] text-blue-600 hover:underline">{t.select_all}</button>
                                        <button onClick={deselectAll} className="text-[10px] text-gray-400 hover:underline">{t.deselect_all}</button>
                                    </div>
                                </div>
                                <div className="grid grid-cols-4 gap-2">
                                    {Array.from({length: 12}, (_, i) => i + 1).map(m => {
                                        const isSelected = selectedMonths.includes(m);
                                        return (
                                            <button 
                                                key={m} 
                                                onClick={() => toggleMonth(m)}
                                                className={`py-2 rounded-md text-sm font-medium transition-all flex flex-col items-center justify-center border ${
                                                    isSelected 
                                                    ? 'bg-blue-100 text-blue-800 border-blue-300 ring-1 ring-blue-300' 
                                                    : 'bg-white text-gray-600 border-gray-200 hover:border-gray-300 hover:bg-gray-50'
                                                }`}
                                            >
                                                {m} <span className="text-[10px] opacity-70">{lang === 'zh' ? '月' : ''}</span>
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>

                        <div className="p-4 bg-gray-50 flex gap-3 border-t border-gray-100">
                            <button onClick={onClose} className="flex-1 py-2.5 rounded-lg border border-gray-300 text-gray-600 font-medium hover:bg-white hover:shadow-sm transition-all">
                                {t.cancel}
                            </button>
                            <button 
                                onClick={() => onConfirm(selectedYear, selectedMonths)} 
                                disabled={selectedMonths.length === 0}
                                className="flex-1 py-2.5 rounded-lg bg-[#1E3A8A] text-white font-bold shadow-md hover:bg-blue-900 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2"
                            >
                                <Eye size={18} />
                                {t.print_preview_btn}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        function App() {
            const [activeTab, setActiveTab] = useState('home');
            const [lang, setLang] = useState('zh'); 
            const [plans, setPlans] = useState([]);
            const [userState, setUserState] = useState({
                readStatus: {},
                notes: {}
            });
            const [selectedDate, setSelectedDate] = useState(null);
            const [loading, setLoading] = useState(true);
            const [currentCalendarDate, setCurrentCalendarDate] = useState(new Date());
            
            // Print State
            const [isPrintModalOpen, setIsPrintModalOpen] = useState(false);
            const [printPreviewData, setPrintPreviewData] = useState(null);

            const t = TRANSLATIONS[lang];

            useEffect(() => {
                const loadData = () => {
                    const initial = generateInitialData();
                    setPlans(initial);
                    const savedUser = localStorage.getItem('pjbc_user');
                    if (savedUser) setUserState(JSON.parse(savedUser));
                    setLoading(false);
                };
                loadData();
            }, []);

            useEffect(() => {
                if (!loading) localStorage.setItem('pjbc_user', JSON.stringify(userState));
            }, [userState, loading]);

            const toggleRead = (date) => setUserState(prev => ({ ...prev, readStatus: { ...prev.readStatus, [date]: !prev.readStatus[date] } }));
            const updateNote = (date, text) => setUserState(prev => ({ ...prev, notes: { ...prev.notes, [date]: text } }));
            
            // --- Handlers ---
            const handlePrintClick = () => setIsPrintModalOpen(true);
            
            const handlePreviewConfirm = (year, months) => {
                setIsPrintModalOpen(false);
                setPrintPreviewData({ year, selectedMonths: months });
            };

            const closePreview = () => setPrintPreviewData(null);

            // --- Sub-Components inside App context ---
            const DetailCard = ({ date, onNavigate }) => {
                const plan = plans.find(p => p.date === date);
                const [readingQuery, setReadingQuery] = useState(null);
                
                // --- Reset reading query when date changes ---
                useEffect(() => {
                    setReadingQuery(null);
                }, [date]);

                if (!plan) return <div className="p-10 text-center text-gray-500">{t.no_data}</div>;
                const isRead = userState.readStatus[date];
                const dailyOneReadings = parseScriptureString(plan.dailyOne);
                const dailyTenReadings = parseScriptureString(plan.dailyTen);
                
                const handlePrev = () => {
                    const d = new Date(date);
                    d.setDate(d.getDate() - 1);
                    const newDate = d.toISOString().split('T')[0];
                    if (onNavigate) onNavigate(newDate);
                };

                const handleNext = () => {
                    const d = new Date(date);
                    d.setDate(d.getDate() + 1);
                    const newDate = d.toISOString().split('T')[0];
                    if (onNavigate) onNavigate(newDate);
                };

                const renderButtons = (readings, source) => (
                    <div className="flex flex-wrap gap-2 mt-2">
                        {readings.map((r, idx) => {
                            const isSelected = readingQuery && readingQuery.bookId === r.bookId && readingQuery.chapter === r.chapter && readingQuery.source === source;
                            const label = getButtonLabel(r, lang);
                            return (
                                <button key={idx} onClick={() => setReadingQuery(isSelected ? null : { ...r, source, label })}
                                    className={`text-xs px-3 py-1.5 rounded-full border flex items-center gap-1 transition-colors ${
                                        isSelected ? "bg-blue-600 text-white border-blue-600 shadow-md" : "bg-white text-blue-600 border-blue-200 hover:bg-blue-50"
                                    }`}>
                                    {isSelected ? <X size={12}/> : <Book size={12}/>}
                                    {label}
                                </button>
                            );
                        })}
                    </div>
                );
                return (
                    <div className="space-y-6">
                        <div className="flex items-center justify-between">
                            <button onClick={handlePrev} className="p-2 hover:bg-gray-100 rounded-full text-gray-400 hover:text-blue-600 transition-colors">
                                <ChevronLeft size={28} />
                            </button>
                            <div className="text-center">
                                <h2 className="text-3xl font-bold text-[#1E3A8A] mb-1">
                                    {parseInt(date.split('-')[1])} / {parseInt(date.split('-')[2])}
                                    <span className="text-lg ml-2 font-medium text-gray-500">
                                        ({lang === 'en' ? WEEKDAY_MAP[plan.weekday] : plan.weekday})
                                    </span>
                                </h2>
                                <div className="text-gray-400 font-medium">{date.split('-')[0]}</div>
                            </div>
                            <button onClick={handleNext} className="p-2 hover:bg-gray-100 rounded-full text-gray-400 hover:text-blue-600 transition-colors">
                                <ChevronRight size={28} />
                            </button>
                        </div>

                        {/* Moved Mark Read Button Here */}
                        <div className="flex justify-center">
                             <button onClick={() => toggleRead(date)} className={`w-full max-w-xs py-3 rounded-full flex items-center justify-center gap-2 font-bold transition-all shadow-md transform hover:scale-[1.02] active:scale-95 ${isRead ? "bg-green-500 text-white shadow-green-200 ring-2 ring-green-100" : "bg-white border-2 border-gray-200 text-gray-600 hover:border-blue-300 hover:text-blue-600"}`}>
                                {isRead ? <CheckCircle size={22} /> : <Circle size={22} />}{isRead ? t.marked : t.mark_read}
                             </button>
                        </div>

                        <div className="flex flex-col gap-4">
                             <div className="bg-blue-50/50 p-4 rounded-xl border border-blue-100 relative group hover:border-blue-200 transition-all">
                                <div className="absolute right-0 top-0 p-2 opacity-10"><BookOpen size={40} className="text-[#1E3A8A]" /></div>
                                <div className="text-xs text-blue-600 font-bold mb-1">{t.daily_one}</div>
                                <div className="text-lg font-bold text-gray-800">{formatScriptureDisplay(plan.dailyOne, lang)}</div>
                                {renderButtons(dailyOneReadings, 'one')}
                                {readingQuery && readingQuery.source === 'one' && (
                                   <BibleReader bookId={readingQuery.bookId} chapter={readingQuery.chapter} label={readingQuery.label} lang={lang} />
                                )}
                             </div>
                             <div className="bg-orange-50/50 p-4 rounded-xl border border-orange-100 relative group hover:border-orange-200 transition-all">
                                <div className="absolute right-0 top-0 p-2 opacity-10"><Sparkles size={40} className="text-[#D97706]" /></div>
                                <div className="text-xs text-orange-600 font-bold mb-1">{t.daily_ten}</div>
                                <div className="text-lg font-bold text-gray-800 leading-snug">{formatScriptureDisplay(plan.dailyTen, lang)}</div>
                                {renderButtons(dailyTenReadings, 'ten')}
                                {readingQuery && readingQuery.source === 'ten' && (
                                   <BibleReader bookId={readingQuery.bookId} chapter={readingQuery.chapter} label={readingQuery.label} lang={lang} />
                                )}
                             </div>
                        </div>
                        
                        {/* 移除了筆記欄位 */}
                    </div>
                );
            };

            const CalendarView = ({ currentDate, setCurrentDate }) => {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth() + 1;
                const daysInMonth = new Date(year, month, 0).getDate();
                const firstDay = new Date(year, month - 1, 1).getDay();
                
                const weekdays = lang === 'zh' 
                    ? ["日", "一", "二", "三", "四", "五", "六"] 
                    : ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

                return (
                    <div className="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden h-full flex flex-col">
                        <div className="p-4 flex items-center justify-between border-b border-gray-100 bg-gray-50/50">
                            <h2 className="font-bold text-lg text-gray-800 flex items-center gap-2"><CalendarIcon size={20} className="text-[#1E3A8A]"/>{year} / {month}</h2>
                            <div className="flex gap-1">
                                <button onClick={() => setCurrentDate(new Date(year, month - 2, 1))} className="p-1 hover:bg-gray-200 rounded-lg text-gray-500"><ChevronLeft size={20}/></button>
                                <button onClick={() => setCurrentDate(new Date(year, month, 1))} className="p-1 hover:bg-gray-200 rounded-lg text-gray-500"><ChevronRight size={20}/></button>
                            </div>
                        </div>
                        <div className="grid grid-cols-7 text-center border-b border-gray-100 bg-gray-50/30">
                            {weekdays.map(d => <div key={d} className="py-3 text-xs font-bold text-gray-400">{d}</div>)}
                        </div>
                        <div className="grid grid-cols-7 auto-rows-fr flex-1">
                            {Array.from({ length: firstDay }).map((_, i) => <div key={`empty-${i}`} className="min-h-[80px] bg-gray-50/10 border-r border-b border-gray-100 last:border-r-0" />)}
                            {Array.from({ length: daysInMonth }).map((_, i) => {
                                const d = i + 1;
                                const dateStr = `${year}-${String(month).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                                const plan = plans.find(p => p.date === dateStr);
                                const isRead = userState.readStatus[dateStr];
                                const isToday = new Date().toISOString().split('T')[0] === dateStr;
                                return (
                                    <div key={dateStr} onClick={() => setSelectedDate(dateStr)} className={`min-h-[80px] p-2 border-r border-b border-gray-100 cursor-pointer transition-all hover:bg-blue-50/50 relative group ${isToday ? 'bg-blue-50/20' : ''}`}>
                                        <div className="flex justify-between items-start mb-1">
                                            <span className={`text-sm w-7 h-7 flex items-center justify-center rounded-full font-bold transition-all ${isToday ? 'bg-[#1E3A8A] text-white shadow-md' : 'text-gray-600 group-hover:bg-gray-200'}`}>{d}</span>
                                            {isRead && <CheckCircle size={16} className="text-green-500" />}
                                        </div>
                                        {plan ? (
                                            <div className="space-y-1 mt-2">
                                                <div className="text-[9px] text-[#1E3A8A] font-medium bg-blue-100/40 px-1.5 py-0.5 rounded leading-tight truncate">
                                                    {formatCalendarDisplay(plan.dailyOne, lang)}
                                                </div>
                                                <div className="hidden md:block text-[9px] text-gray-500 px-1 mt-0.5 leading-tight truncate">
                                                    {formatCalendarDisplay(plan.dailyTen, lang)}
                                                </div>
                                            </div>
                                        ) : <span className="text-[10px] text-gray-300"></span>}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            const TableView = () => {
                const [search, setSearch] = useState("");
                const [filterYear, setFilterYear] = useState(currentCalendarDate.getFullYear());
                const [filterMonth, setFilterMonth] = useState(currentCalendarDate.getMonth() + 1);

                const handlePrevMonth = () => {
                    if (filterMonth === 1) {
                        setFilterMonth(12);
                        setFilterYear(prev => prev - 1);
                    } else {
                        setFilterMonth(prev => prev - 1);
                    }
                };

                const handleNextMonth = () => {
                    if (filterMonth === 12) {
                        setFilterMonth(1);
                        setFilterYear(prev => prev + 1);
                    } else {
                        setFilterMonth(prev => prev + 1);
                    }
                };

                const filtered = useMemo(() => {
                    const prefix = `${filterYear}-${String(filterMonth).padStart(2,'0')}`;
                    return plans.filter(p => p.date.startsWith(prefix) && (p.dailyOne.includes(search) || p.dailyTen.includes(search)));
                }, [plans, filterYear, filterMonth, search]);
                return (
                    <div className="space-y-4 max-w-4xl mx-auto pb-24">
                        <div className="bg-white p-4 rounded-xl border border-gray-200 sticky top-0 z-20 shadow-sm flex flex-col md:flex-row gap-4 no-print">
                            <div className="flex items-center gap-2 justify-between md:justify-start">
                                <button onClick={handlePrevMonth} className="p-2 hover:bg-gray-100 rounded-lg text-gray-500 transition-colors border border-transparent hover:border-gray-200">
                                    <ChevronLeft size={20} />
                                </button>
                                <div className="flex gap-2">
                                    <select value={filterYear} onChange={e => setFilterYear(Number(e.target.value))} className="bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-100">{[2025, 2026, 2027].map(y => <option key={y} value={y}>{y}</option>)}</select>
                                    <select value={filterMonth} onChange={e => setFilterMonth(Number(e.target.value))} className="bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-100">{Array.from({length:12}).map((_,i) => <option key={i+1} value={i+1}>{i+1}月</option>)}</select>
                                </div>
                                <button onClick={handleNextMonth} className="p-2 hover:bg-gray-100 rounded-lg text-gray-500 transition-colors border border-transparent hover:border-gray-200">
                                    <ChevronRight size={20} />
                                </button>
                            </div>
                            <div className="relative flex-1">
                                <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" size={16}/><input type="text" placeholder="Search..." className="w-full pl-9 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-100" value={search} onChange={e => setSearch(e.target.value)} />
                            </div>
                        </div>
                        <div className="space-y-3 no-print">
                            {filtered.length === 0 && <div className="text-center py-10 text-gray-400">無資料</div>}
                            {filtered.map(p => (
                                <div key={p.date} onClick={() => setSelectedDate(p.date)} className="bg-white p-4 rounded-xl border border-gray-200 flex items-center gap-4 hover:border-blue-300 cursor-pointer group transition-all hover:shadow-sm">
                                    <div className="w-14 text-center shrink-0"><div className="text-xl font-bold text-gray-700">{p.date.split('-')[2]}</div><div className="text-xs text-gray-400">({lang === 'en' ? WEEKDAY_MAP[p.weekday] : p.weekday})</div></div>
                                    <div className="flex-1 grid grid-cols-1 md:grid-cols-2 gap-1 md:gap-4">
                                        <div>
                                            <span className="text-[10px] text-gray-400 font-bold uppercase">{t.daily_one}</span>
                                            <div className="text-[#1E3A8A] font-medium text-sm group-hover:text-blue-700">{formatScriptureDisplay(p.dailyOne, lang)}</div>
                                        </div>
                                        <div>
                                            <span className="text-[10px] text-gray-400 font-bold uppercase">{t.daily_ten}</span>
                                            <div className="text-gray-600 text-sm group-hover:text-gray-800">{formatScriptureDisplay(p.dailyTen, lang)}</div>
                                        </div>
                                    </div>
                                    <div className="shrink-0 text-gray-300">{userState.readStatus[p.date] ? <CheckCircle size={20} className="text-green-500" /> : <ChevronRight size={20} />}</div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            // 使用 Portal 將預覽畫面渲染到獨立節點
            const PreviewPortal = ({ children }) => {
                const mountNode = document.getElementById('print-preview-root');
                return createRoot(mountNode).render(children);
            };

            // Effect: 處理 Preview 資料改變時的渲染
            useEffect(() => {
                const mountNode = document.getElementById('print-preview-root');
                if (printPreviewData) {
                    if (mountNode) {
                        const root = createRoot(mountNode);
                        root.render(
                            <PrintPreviewOverlay 
                                year={printPreviewData.year} 
                                selectedMonths={printPreviewData.selectedMonths} 
                                plans={plans} 
                                lang={lang} 
                                onClose={closePreview} 
                            />
                        );
                        return () => setTimeout(() => root.unmount(), 0);
                    }
                }
            }, [printPreviewData, plans, lang]);
            

            if (loading) return <div className="h-screen flex items-center justify-center text-[#1E3A8A] font-bold">Loading...</div>;

            return (
                <div className="min-h-screen bg-[#F9F9F7] text-[#374151] pb-20 md:pb-0 md:pt-20">
                    
                    {/* 列印預覽 Overlay (當 printPreviewData 存在時渲染) */}
                    {printPreviewData && (
                        <PrintPreviewOverlay 
                            year={printPreviewData.year} 
                            selectedMonths={printPreviewData.selectedMonths} 
                            plans={plans} 
                            lang={lang} 
                            onClose={closePreview} 
                        />
                    )}

                    <nav className="fixed bottom-0 md:top-0 md:bottom-auto left-0 w-full bg-white/90 backdrop-blur-md border-t md:border-b border-gray-200 z-40 px-6 py-2 md:py-3 shadow-lg md:shadow-sm no-print">
                        <div className="max-w-5xl mx-auto flex justify-between items-center">
                            <div className="hidden md:flex items-center gap-3"><div className="w-9 h-9 rounded-lg bg-[#1E3A8A] flex items-center justify-center text-white font-bold text-lg shadow-sm">P</div><span className="text-xl font-bold tracking-tight text-[#1E3A8A]">PJBC</span></div>
                            <div className="flex w-full md:w-auto justify-around md:gap-8">
                                {[{id:'home',icon:Home,label:t.nav.home},{id:'calendar',icon:CalendarIcon,label:t.nav.calendar},{id:'table',icon:List,label:t.nav.table},{id:'admin',icon:Settings,label:t.nav.admin}].map(i => (
                                    <button key={i.id} onClick={() => setActiveTab(i.id)} className={`flex flex-col md:flex-row items-center gap-1 md:gap-2 p-2 rounded-xl transition-all ${activeTab === i.id ? "text-[#1E3A8A] bg-blue-50 font-semibold" : "text-gray-400 hover:text-[#1E3A8A] hover:bg-gray-50"}`}>
                                        <i.icon size={22} strokeWidth={activeTab === i.id ? 2.5 : 2} /><span className="text-[10px] md:text-sm">{i.label}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </nav>

                    <main className="p-4 md:p-8 max-w-6xl mx-auto no-print">
                        {activeTab === 'home' && (
                            <div className="space-y-6 animate-in slide-in-from-bottom-4 duration-500">
                                <div className="flex flex-col gap-4">
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <div className="text-[#D97706] font-bold text-sm mb-1 flex items-center gap-2">
                                                <Fish size={16} /> 
                                                {lang === 'zh' ? "水深之處，下網打魚" : "Launch out into the deep"}
                                            </div>
                                            <h1 className="text-2xl md:text-4xl font-bold text-[#1E3A8A] tracking-tight leading-snug">
                                                {t.title}<br/>{t.subtitle}
                                            </h1>
                                        </div>
                                        <div className="flex flex-col items-end gap-2">
                                            <div className="flex gap-2">
                                                <button onClick={handlePrintClick} className="flex items-center gap-1 text-xs font-bold border border-gray-300 bg-white rounded-full px-3 py-1 shadow-sm hover:bg-gray-50 transition-all text-gray-800">
                                                    <Printer size={14} /> {t.print_btn}
                                                </button>
                                                <button 
                                                    onClick={() => setLang(l => l === 'zh' ? 'en' : 'zh')} 
                                                    className="flex items-center gap-1 text-xs font-bold border border-gray-300 bg-white rounded-full px-3 py-1 shadow-sm hover:bg-gray-50 transition-all text-gray-600"
                                                >
                                                    <Globe size={14} /> {lang === 'zh' ? 'EN' : '中'}
                                                </button>
                                            </div>
                                            <button 
                                                onClick={() => {
                                                    const now = new Date();
                                                    setSelectedDate(now.toISOString().split('T')[0]);
                                                    setCurrentCalendarDate(now);
                                                }} 
                                                className="bg-[#1E3A8A] text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl hover:bg-blue-900 hover:scale-105 transition-all flex items-center gap-2 text-base whitespace-nowrap"
                                            >
                                                <BookOpen size={20} /> {t.today_btn}
                                            </button>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-3 md:flex md:gap-4">
                                        <div className="bg-white p-3 rounded-xl border border-gray-200 shadow-sm flex items-center gap-3 flex-1">
                                            <div className="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center"><TrendingUp size={20} className="text-[#1E3A8A]" /></div>
                                            <div><div className="text-xs text-gray-500">{t.days_read}</div><div className="font-bold text-[#1E3A8A] flex items-baseline gap-1">{Object.values(userState.readStatus).filter(Boolean).length} <span className="text-xs font-normal text-gray-400">{t.days_unit}</span></div></div>
                                        </div>
                                        <div className="bg-white p-3 rounded-xl border border-gray-200 shadow-sm flex items-center gap-3 flex-1 cursor-pointer hover:border-blue-300 transition-all group" onClick={() => setActiveTab('table')}>
                                            <div className="w-10 h-10 rounded-full bg-orange-50 flex items-center justify-center group-hover:bg-orange-100 transition-colors"><LayoutGrid size={20} className="text-[#D97706]" /></div>
                                            <div><div className="text-xs text-gray-500">{t.full_schedule}</div><div className="font-bold text-gray-700 group-hover:text-[#D97706] text-sm">{t.view_list}</div></div>
                                        </div>
                                    </div>
                                </div>
                                <div className="w-full">
                                    <CalendarView currentDate={currentCalendarDate} setCurrentDate={setCurrentCalendarDate} />
                                </div>
                            </div>
                        )}
                        {activeTab === 'calendar' && (
                             <div className="max-w-5xl mx-auto animate-in fade-in h-[calc(100vh-140px)]">
                                <CalendarView currentDate={currentCalendarDate} setCurrentDate={setCurrentCalendarDate} />
                             </div>
                        )}
                        {activeTab === 'table' && <div className="animate-in fade-in"><TableView /></div>}
                        {activeTab === 'admin' && <div className="animate-in fade-in text-center p-10 text-gray-500">Settings (Demo)</div>}
                    </main>

                    {selectedDate && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm transition-opacity no-print">
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-in fade-in zoom-in-95 duration-200 flex flex-col">
                                <div className="sticky top-0 bg-white/95 backdrop-blur z-20 flex justify-end p-3 border-b border-gray-100"><button onClick={() => { setSelectedDate(null); }} className="p-2 hover:bg-gray-100 rounded-full text-gray-500"><X size={24} /></button></div>
                                <div className="p-6 pt-2 overflow-y-auto custom-scrollbar"><DetailCard date={selectedDate} onNavigate={setSelectedDate} /></div>
                            </div>
                        </div>
                    )}
                    
                    <PrintModal 
                        isOpen={isPrintModalOpen} 
                        onClose={() => setIsPrintModalOpen(false)} 
                        onConfirm={handlePreviewConfirm}
                        availableYears={[2025, 2026]}
                        lang={lang}
                    />
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
